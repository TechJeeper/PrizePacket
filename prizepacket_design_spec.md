Project Name: PrizePacket
Version: 3.0.0 (Zero-Dependency Edition)
Type: Web Application (Core PHP/MySQL)
Deployment Target: Shared Hosting (Ionos, etc.)
1. Project Overview
PrizePacket is a lightweight, self-contained web application for managing giveaways. It is built to run on restrictive shared hosting environments where composer, npm, and shell access are not available.
Core Philosophy: "Upload and Run." All logic, including complex API integrations (Google/Twitch/YouTube), is handled via native PHP cURL functions and manual OAuth flows.
2. Technology Stack & Constraints
The AI Builder must strictly adhere to these constraints:
* Server-Side: Native PHP 8.0+ (No Frameworks, No Composer).
* Database: MySQL 5.7 or 8.0 (standard shared hosting support).
* HTTP Requests: cURL must be used for all API calls (replacing Guzzle).
* Configuration: A config.php file (generated by the installer) instead of .env.
* Frontend:
   * HTML5 / CSS3.
   * Tailwind CSS (via CDN script tag).
   * Alpine.js (via CDN script tag for interactivity).
   * Note: No build steps (npm/webpack) allowed.
* OAuth: Manual implementation of the OAuth 2.0 "Authorization Code" flow.
3. Database Schema (SQL)
Save this as database/schema.sql.
-- 1. App Configuration (Replaces .env for some settings)
CREATE TABLE settings (
   setting_key VARCHAR(50) PRIMARY KEY,
   setting_value TEXT
);

-- 2. Users (Single Admin usually, but scalable)
CREATE TABLE users (
   id INT AUTO_INCREMENT PRIMARY KEY,
   username VARCHAR(50) NOT NULL,
   password_hash VARCHAR(255) NOT NULL,
   created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 3. API Tokens (Stores OAuth Refresh Tokens)
CREATE TABLE api_tokens (
   id INT AUTO_INCREMENT PRIMARY KEY,
   provider VARCHAR(20) NOT NULL, -- 'google', 'twitch'
   access_token TEXT,
   refresh_token TEXT,
   expires_at INT,
   scope TEXT,
   updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 4. Inventory Items
CREATE TABLE inventory (
   id INT AUTO_INCREMENT PRIMARY KEY,
   item_name VARCHAR(255) NOT NULL,
   sponsor VARCHAR(255),
   image_url VARCHAR(255), -- stored as URL string
   qty_initial INT DEFAULT 1,
   qty_current INT DEFAULT 1,
   created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 5. Campaigns
CREATE TABLE campaigns (
   id INT AUTO_INCREMENT PRIMARY KEY,
   title VARCHAR(255) NOT NULL,
   is_active TINYINT(1) DEFAULT 1,
   created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 6. Entrants (The Pool)
CREATE TABLE entrants (
   id INT AUTO_INCREMENT PRIMARY KEY,
   campaign_id INT NOT NULL,
   platform ENUM('twitch', 'youtube', 'google_sheet', 'manual') NOT NULL,
   platform_user_id VARCHAR(100), -- Unique ID from the platform
   display_name VARCHAR(100) NOT NULL,
   source_data VARCHAR(255), -- e.g. "Sheet Row 5" or "Chat"
   UNIQUE KEY (campaign_id, platform, platform_user_id),
   FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE
);

-- 7. Winners
CREATE TABLE winners (
   id INT AUTO_INCREMENT PRIMARY KEY,
   campaign_id INT,
   inventory_id INT,
   entrant_id INT,
   display_name VARCHAR(100),
   contact_status ENUM('pending', 'contacted', 'info_received', 'shipped') DEFAULT 'pending',
   shipping_info TEXT,
   notes TEXT,
   won_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
   FOREIGN KEY (campaign_id) REFERENCES campaigns(id),
   FOREIGN KEY (inventory_id) REFERENCES inventory(id)
);

4. Architecture & File Structure
Since we cannot use a router package, we will use a simple file-based routing structure.
/public_html/ (Root of the shared host)
├── config.php             (Generated by installer - DB creds & API Keys)
├── index.php              (Login / Dashboard)
├── install.php            (Setup Wizard - Delete after use)
├── logout.php
├── style.css              (Custom overrides)
├── functions/             (Helper Logic)
│   ├── db.php             (PDO Connection)
│   ├── api_google.php     (Raw cURL functions for Sheets/YT)
│   ├── api_twitch.php     (Raw cURL functions for Twitch)
│   └── helpers.php        (Sanitization, Session checks)
├── modules/               (Page Logic)
│   ├── inventory.php
│   ├── campaigns.php
│   ├── draw.php           (The animation page)
│   └── fulfillment.php
└── api/                   (AJAX Endpoints)
   ├── sync_sheet.php
   ├── sync_twitch.php
   └── pick_winner.php

5. Feature Specifications (The "No-Lib" Approach)
Module A: The Installer (install.php)
* Logic:
   1. Check if config.php exists. If yes, redirect to index.php.
   2. Show HTML Form: DB Host, DB Name, DB User, DB Pass, App URL.
   3. Action: Test PDO connection.
   4. Action: Create config.php file with PHP defined constants (define('DB_HOST', '...');).
   5. Action: Parse database/schema.sql and run queries via PDO.
   6. Action: Insert a default Admin user (User: admin, Pass: password).
   7. Output: "Installation Complete. Delete install.php."
Module B: OAuth Handlers (Manual Flow)
* Configuration: Users must manually edit config.php or a "Settings" page to input their CLIENT_ID and CLIENT_SECRET for Google/Twitch.
* Twitch Auth Flow (functions/api_twitch.php):
   1. Link: https://id.twitch.tv/oauth2/authorize?client_id=...&response_type=code&scope=chat:read
   2. Callback: Exchange $_GET['code'] via POST https://id.twitch.tv/oauth2/token using curl_exec.
   3. Save access_token and refresh_token to DB.
* Google Auth Flow (functions/api_google.php):
   1. Link: https://accounts.google.com/o/oauth2/v2/auth?...&scope=https://www.googleapis.com/auth/spreadsheets.readonly
   2. Callback: Exchange code via cURL. Save tokens.
Module C: Data Ingest (Raw REST)
* Google Sheets:
   * Endpoint: GET https://sheets.googleapis.com/v4/spreadsheets/{ID}/values/{RANGE}
   * Header: Authorization: Bearer {DB_ACCESS_TOKEN}
   * Logic: Decode JSON response json_decode($response, true), iterate ['values'], insert into entrants.
* Twitch/YouTube:
   * Similar cURL GET requests using the stored tokens.
Module D: The Draw (Frontend + AJAX)
* Frontend: Use Alpine.js x-data to handle the state.
* Animation: A simple CSS ticker or JS interval cycling through names.
* Backend (api/pick_winner.php):
   * SELECT * FROM entrants WHERE campaign_id = ? ORDER BY RAND() LIMIT 1.
   * Crucial: Check if entrant_id is already in winners table.
   * Return JSON: {"status": "success", "winner": "Username"}.
6. Implementation Prompts (For AI Builder)
Phase 1: Setup & Database
"Create a file install.php. It should contain a comprehensive HTML form to accept Database credentials. On POST, it should try to connect via PDO. If successful, write the credentials to a config.php file using PHP define() statements, and then execute the SQL schema creation logic. Do NOT use any external dependencies."
Phase 2: Core Functions
"Create a functions/db.php file that returns a PDO connection using the constants from config.php. Then, create functions/helpers.php with a function apiRequest($url, $method, $headers, $data) that uses pure PHP curl_init to handle API calls. Handle basic cURL error checking."
Phase 3: Inventory & Campaigns
"Create modules/inventory.php. Use standard PHP/HTML mixed syntax. Include Tailwind CSS via CDN. Connect to DB, fetch all items, and display them in a table. Add a simple HTML form at the top to INSERT a new item. Ensure all SQL inputs are prepared statements."
Phase 4: Manual OAuth (The Hard Part)
"Create modules/settings.php. Add forms to save Client IDs and Secrets. Then, implement the 'Connect Google' logic. Create a link that redirects to Google's OAuth URL. Create a separate file google_callback.php that captures the 'code', uses curl to swap it for a token at https://oauth2.googleapis.com/token, and saves the JSON response to the api_tokens table."
Phase 5: The Ingest
"Create api/sync_sheet.php. It should accept a spreadsheet_id and range via POST. Retrieve the Google Access Token from the DB. Use the helper apiRequest function to hit the Google Sheets API endpoint. Loop through the returned rows and INSERT IGNORE them into the entrants table."